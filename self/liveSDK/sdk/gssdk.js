/*!
 * Gensee EasyCast JavaScript SDK
 * http://www.gensee.com/
 * Date: 2013-1-29
 */
var app=getApp();var SDK=(function(){var c={};c.defaultKey="_GS_SDK_default_group_"+(new Date()).getTime();c.suites={};c.widgets={};c.N=0;c.register=function(g,d){var i=g.split(".");var h=c;var f=null;while(f=i.shift()){if(i.length){if(h[f]===undefined){h[f]={}}h=h[f]}else{if(h[f]===undefined){h[f]=d(c)}}}};c.trim=function(d){if(typeof d!=="string"){return d}if(typeof d.trim==="function"){return d.trim()}else{return d.replace(/^(\u3000|\s|\t|\u00A0)*|(\u3000|\s|\t|\u00A0)*$/g,"")}};c.isEmpty=function(d){if(d===undefined){return true}else{if(d==null){return true}else{if(typeof d==="string"){if(c.trim(d)==""){return true}}}}return false};c.isNotEmpty=function(d){return !c.isEmpty(d)};c.Event=(function(d,h,g,i,f){this.type=d;this.target=h;this.data=g;if(typeof i=="string"){this.receiver=i}else{this.cb=i;this.receiver=f}});c.Logger=(function(d){var g=this;this.name=d;this.logs=[];var f={"DEBUG":0,"INFO":1,"WARN":2,"ERROR":3,"FATAL":4};this.level="INFO";this.out=function(h){g.logs.push(h)};this.log=function(l,i,j){i=i?i:"info";var k=f[i.toUpperCase()];var h=f[g.level.toUpperCase()];if(typeof k==="number"&&typeof h==="number"){if(k<h){return}}if(typeof l!=="string"){this.log("log(msg, type), type of msg must be 'string'","ERROR",l);return}};this.moveLogs=function(h){return g.logs.splice(0,h||g.logs.length)}});c.logger=new c.Logger();c.log=c.logger.log;c.asyncRun=function(d,f){setTimeout(function(){try{d(f)}catch(g){c.log(""+g,"ERROR",g);throw g}},0)};c.register("core.util.assignProperties",function(){return function(f,h,j,d){if(typeof h!="undefined"){for(var g in h){var i=h[g];if(typeof j==="function"){g=j(g)}if(typeof d==="function"){i=d(i)}f[g]=i}}return f}});var b=(function(){var d=function(h,g,f){this.enabled=true;this.orign=h;this.type=g;this.elem=f?f.elem:{};this.attrs=f?f.attrs:null;this.initId()};d.fn=d.prototype={constructor:d,attr:function(f){if(c.isNotEmpty(this.attrs)){return this.attrs[f]}var g="";try{if(this.elem.getAttribute){g=this.elem.getAttribute(f);g=c.trim(g)}}catch(h){c.log(".getAttribute(name) throw:"+h,"ERROR",this)}return c.isEmpty(g)?"":g},initId:function(){var f=this.attr("id");if(c.isEmpty(f)){f="_GS_WIDGET_"+c.N++;f+="_"+(new Date()).getTime()}this.id=f},bind:function(g,f){if(!this.enabled){return}g=g.toLowerCase();if(!this.suite.eventsmap[g]){this.suite.eventsmap[g]=[]}this.suite.eventsmap[g].push({wgid:this.id,handler:f})},unbind:function(j,h){if(!this.enabled){return}j=j.toLowerCase();var f=this.suite.eventsmap[j];if(f){for(var g=0;g<f.length;g++){if(f[g]["handler"]==h){f.splice(g,1);break}}}},fire:function(k){if(!this.enabled){return}if(!(k instanceof c.Event)){c.log("It's not instanceof Event - "+k,"ERROR");throw"[SDK]ERROR! It's not a instance of Event - "+k}if(k.type=="onRewardResponse"&&k.data&&k.data.userControl!=undefined&&k.data.userControl=="false"&&k.data.returnCode=="0"){window.top.location.href=k.data.codeUrl;return}var j=k.type.toLowerCase();var g=this.suite.eventsmap[j];var f=0;if(g){f=g.length;var l=k.receiver;for(var h=0;h<g.length;h++){if(!l){c.asyncRun(g[h]["handler"],k)}else{if(l==g[h]["wgid"]){c.asyncRun(g[h]["handler"],k)}}}}c.log("send message of '"+k.type+"'","DEBUG",k);return f},};return d})();var a=(function(){var d=function(f){if(c.isEmpty(f)){f=c.defaultKey}this.key=f;this.init()};d.fn=d.prototype={constructor:d,init:function(){this.eventsmap={};this.widgets={}},loadWidget:function(f){if(typeof f.id===undefined){throw new ERROR("widget's id is undefined. "+f)}if(this.widgets[f.id]===undefined){f.suite=this;this.widgets[f.id]=f;c.widgets[f.id]=f;c.log("Widget("+f.id+") has loaded!","INFO",f)}},createWidget:function(i,g,f){g=g.toLowerCase();var h=new b(i,g,f);this.loadWidget(h);return h},clearWidget:function(f){this.eventsmap={};this.widgets={};c.suites={};c.widgets={}},removeWidget:function(j){if(typeof j===undefined){throw new ERROR("widgetId is undefined.")}var k=this.widgets[j];if(c.isEmpty(k)){throw new ERROR("widget not found in suite for widgetId:"+j)}k.suite=null;for(var h in this.eventsmap){var f=this.eventsmap[h];if(f){for(var g=0;g<f.length;g++){if(f[g]["wgid"]==j){f.splice(g,1);break}}}}delete this.widgets[j];delete c.widgets[j];c.log("Widget("+j+") has remove!","INFO",j);return k}};return d})();c.suite=function(d){if(c.isEmpty(d)){d=c.defaultKey}var f=c.suites[d];if(typeof f=="undefined"){f=new a(d);c.suites[d]=f}return f};return c})();SDK.logger.name="SDK";SDK.register("api.ready",function(){return function(a){SDK.core.dom.ready(a)}});SDK.register("api.widget",function(){return function(a){return SDK.widgets[a]}});SDK.register("api.widget.proxy",function(a){return function(d){var c=a.api.widget(d);if(a.isEmpty(c)){a.log("No widget which id is "+d,"ERROR");throw"[SDK]ERROR! no widget which id is "+d}if(c.proxy===undefined){var b=c.proxy={id:d,type:c.type,group:c.suite.key,enabled:true};c.eventTargetProxy={id:d,type:c.type};b.extend=function(f){a.core.util.assignProperties(b,f)};b.bind=function(g,f){if(!b.enabled){return}if(typeof g!=="string"){a.log("Type of event must be a string!","ERROR");return}if(typeof f!=="function"){a.log("Handler of event must be a function!","ERROR");return}g=a.trim(g);if(a.isEmpty(g)){a.log("Empty type of event is invalid!","ERROR");return}c.bind(g,f)};b.unbind=function(g,f){if(!b.enabled){return}if(typeof g!=="string"){a.log("Type of event must be a string!","ERROR");return}if(typeof f!=="function"){a.log("Handler of event must be a function!","ERROR");return}g=a.trim(g);if(a.isEmpty(g)){a.log("Empty type of event is invalid!","ERROR");return}c.unbind(g,f)};b.send=function(h,k,g,j){if(!b.enabled){return}if(typeof g=="string"){j=g;g=undefined}if(typeof h!=="string"){a.log("Type of message must be a string!","ERROR");throw"[SDK]ERROR! Type of message must be a string!"}h=a.trim(h);h=typeCenter.types(h);var i=new a.Event(h,c.eventTargetProxy,k,g,j);var f=c.fire(i);if(f==0){var l=c.suite.key==a.defaultKey?"":c.suite.key+".";a.log("No handler had bound to '"+l+i.type+"'!","WARN",i)}return f};b.activeShakehand=function(j,g,h){if(!b.enabled){return}c._dataInMyHand=g;if(typeof h==="string"&&a.isNotEmpty(h)){c._shakeWithType=h}else{delete c._shakeWithType}if(typeof j=="function"){b.shakehand=function(o){setTimeout(function(){j(o._dataInMyHand)},0)}}else{b.shakehand=function(){}}var i=c.suite;if(i){for(var f in i.widgets){var n=i.widgets[f];if(n.id==c.id){continue}var m=a.api.widget.proxy(n.id);if(a.isNotEmpty(m.shakehand)){var l=true;if(c._shakeWithType&&c._shakeWithType!=n.type){l=false}var k=true;if(n._shakeWithType&&n._shakeWithType!=c.type){k=false}if(l&&k){b.shakehand(n);m.shakehand(c)}}}}}}return c.proxy}});var typeCenter=(function(){var b={};var a={};b.types=function(c){if(typeof c==="object"){SDK.core.util.assignProperties(a,c,function(f){return SDK.trim(f).toLowerCase()})}else{if(typeof c==="string"){var d=c.toLowerCase();return a[d]?a[d]:c}else{if(SDK.isEmpty(c)){return a}else{SDK.log("typeCenter.types(arg):arg not support-"+c,"WARN")}}}};return b})();var GS={version:"1.0",autoload:false,init:function(a){SDK.log("[SDK]init","INFO",a)},createChannel:function(b){var a=SDK.suite(b).createWidget("CHANNEL","CHANNEL");return SDK.api.widget.proxy(a.id)},removeChannel:function(b,a){SDK.suite(a).removeWidget(b)},clearChannel:function(){SDK.suite().clearWidget()}};var tool={};tool.checkObjectIsNull=function(a){return(a==null||a==undefined||typeof(a)=="undefined")?true:false};tool.checkObjectIsNotNull=function(a){return !this.checkObjectIsNull(a)};tool.isFunction=function(a){return(typeof(a)=="function")?true:false};tool.checkParamsIsNotNull=function(str,obj){if(this.checkObjectIsNotNull(str)){var splitArray=str.split(".");var objSplit="";for(var i=0;i<splitArray.length;i++){if(i!=0){objSplit+=".";objSplit+=splitArray[i]}else{objSplit="obj"}if(eval("typeof("+objSplit+")=='undefined'")){return false}}return true}return false};tool.extend=function(){var c,b,h,j,g=arguments[0]||{},d=1,f=arguments.length,a=false;if(typeof g==="boolean"){a=g;g=arguments[1]||{};d=2}if(typeof g!=="object"&&!this.isFunction(g)){g={}}if(f===d){g=this;--d}for(;d<f;d++){if((c=arguments[d])!=null){for(b in c){h=g[b];j=c[b];if(g===j){continue}if(j!==undefined){g[b]=j}}}}return g};tool.trim=function(a){if(typeof a!=="string"){return a}if(typeof a.trim==="function"){return a.trim()}else{return a.replace(/^(\u3000|\s|\t|\u00A0)*|(\u3000|\s|\t|\u00A0)*$/g,"")}},tool.isEmptyObject=function(b){for(var a in b){return false}return true};tool.decodeHex=function(c){if(c.length%2){return""}var b="";for(var a=0;a<c.length;a+=2){b+="%"+c.charAt(a)+c.charAt(a+1)}return decodeURIComponent(b)};tool.createUUID=function(){var d=new Date(1582,10,15,0,0,0,0);var i=new Date();var k=i.getTime()-d.getTime();var b="-";var l=tool.getIntegerBits(k,0,31);var j=tool.getIntegerBits(k,32,47);var g=tool.getIntegerBits(k,48,59)+"1";var c=tool.getIntegerBits(tool.rand(4095),0,7);var f=tool.getIntegerBits(tool.rand(4095),0,7);var a=tool.getIntegerBits(tool.rand(8191),0,7)+tool.getIntegerBits(tool.rand(8191),8,15)+tool.getIntegerBits(tool.rand(8191),0,7)+tool.getIntegerBits(tool.rand(8191),8,15)+tool.getIntegerBits(tool.rand(8191),0,15);return l+b+j+b+g+b+c+f+b+a},tool.getIntegerBits=function(g,h,b){var a=tool.returnBase(g,16);var d=new Array();var f="";var c=0;for(c=0;c<a.length;c++){d.push(a.substring(c,c+1))}for(c=Math.floor(h/4);c<=Math.floor(b/4);c++){if(!d[c]||d[c]==""){f+="0"}else{f+=d[c]}}return f},tool.returnBase=function(c,d){var f=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];if(c<d){var b=f[c]}else{var g=""+Math.floor(c/d);var a=c-g*d;if(g>=d){var b=this.returnBase(g,d)+f[a]}else{var b=f[g]+f[a]}}return b},tool.rand=function(a){return Math.floor(Math.random()*a)};var hTasks=[];var task=function(a){hTasks=a.hTasks;var b=this;this.executedImmediately=a.executedImmediately!=undefined?a.executedImmediately:false;this.taskArray=new Array();this.taskFunction=new Array();this.defaultOpt={interval:200,status:false};this.anyOpt={interval:200,status:false};this.timeOutObj=null;this.anyOutObj=null;this.dealTask=false;this.i=0;this.timeOut=function(){b.dealTask=true;var g=b.taskArray;var n=b.taskFunction;var l=100000;if(g.length>0){var h=app.globalData.currentTime*1000;if(h>=0){for(var f=0;f<g.length;f++){var c=g[f];if(c.startTime==null||c.startTime==undefined||typeof(c.startTime)=="undefined"||c.startTime==""){var m=c.type;for(var d=0;d<n.length;d++){var k=n[d];if(k.type==m){k.startFun.call(this,c.data);break}}g.splice(f,1);f--}else{if(c.startTime<=h){if(c.endTime==null||c.endTime==undefined||typeof(c.endTime)=="undefined"||c.endTime==""){var m=c.type;for(var d=0;d<n.length;d++){var k=n[d];if(k.type==m){k.startFun.call(this,c.data);break}}g.splice(f,1);f--}else{if(h<c.endTime){var m=c.type;if(c.startDeal==null||c.startDeal==undefined||typeof(c.startDeal)=="undefined"){for(var d=0;d<n.length;d++){var k=n[d];if(k.type==m){c.startDeal=true;k.startFun.call(this,c.data);break}}}}else{var m=c.type;for(var d=0;d<n.length;d++){var k=n[d];if(k.type==m){k.endFun.call(this,c.data);break}}g.splice(f,1);f--}}}}}}}b.dealTask=false};this.anyTimeOut=function(){var c=b.taskArray;var l=b.taskFunction;if(c.length>0){for(var h=0;h<c.length;h++){var f=c[h];if(f.type=="ems"&&(f.data.dealFunction=="onPriChat"||f.data.dealFunction=="onChatRemove"||f.data.dealFunction=="onPublicChat"||f.data.dealFunction=="onThirdPartChat"||(f.data.dealFunction=="onSetting"&&f.data.content.option=="chat"))){var d=f.type;for(var g=0;g<l.length;g++){var k=l[g];if(k.type==d){k.startFun.call(this,f.data);break}}c.splice(h,1);h--}}}}};task.prototype.switchMedia=function(a){this.media=media};task.prototype.setInterval=function(a){var b=this;if(!this.dealTask){this.defaultOpt.interval=a;if(this.defaultOpt.status){clearInterval(this.timeOutObj);this.timeOutObj=setInterval(function(){b.timeOut()},this.defaultOpt.interval)}return true}return false};task.prototype.start=function(){var a=this;if(this.anyOutObj!=null){clearInterval(this.anyOutObj)}if(!this.defaultOpt.status){this.timeOutObj=setInterval(function(){a.timeOut()},this.defaultOpt.interval);this.defaultOpt.status=true}};task.prototype.stop=function(){if(!this.dealTask){clearInterval(this.timeOutObj);this.defaultOpt.status=false;return true}else{return false}};task.prototype.anyStart=function(){var a=this;if(!this.anyOpt.status){this.anyOutObj=setInterval(function(){a.anyTimeOut()},this.anyOpt.interval);this.anyOpt.status=true}};task.prototype.addTaskFunction=function(d,c,b){var f=this.taskFunction;if(tool.checkObjectIsNull(d)){return false}if(!tool.isFunction(c)){return false}var a={type:d,startFun:c};if(!tool.isFunction(b)){a.endFun=function(){}}else{a.endFun=b}f.push(a);return true};task.prototype.addTask=function(f,g,d,c){var a=this.taskArray;if(tool.checkObjectIsNull(f)){return false}var b={};if(g.taskId){if(compareHisTask(f+g.taskId)){return}else{loadHisTask(f+g.taskId)}}if(this.executedImmediately){b={type:f,data:g,startTime:null,endTime:null}}else{b={type:f,data:g,startTime:d,endTime:c}}a.push(b);return true};task.prototype.clearTask=function(){var a=this.taskArray;a.splice(0,a.length)};task.prototype.executeAllTask=function(){var a=this.taskArray;console.log("[executeAllTask]:"+a.length);for(var c=0;c<a.length;c++){var b=a[c];b.startTime=null;b.endTime=null}};function loadHisTask(a){var b={};b.taskId=a;b.time=new Date().getTime();hTasks.push(b)}function compareHisTask(b){for(var a=0;a<hTasks.length;a++){var c=hTasks[a];if(b==c.taskId){return true}}return false}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function XMLReader(){}function parse(w,r,k,s,n){function p(i){var I=i.slice(1,-1);return I in k?k[I]:"#"===I.charAt(0)?function(K){if(K>65535){var J=55296+((K-=65536)>>10),a=56320+(1023&K);return String.fromCharCode(J,a)}return String.fromCharCode(K)}(parseInt(I.substr(1).replace("x","0x"))):(n.error("entity not found:"+i),i)}function D(a){if(a>l){var i=w.substring(l,a).replace(/&#?\w+;/g,p);g&&G(l),s.characters(i,0,a-l),l=a}}function G(i,a){for(;i>=z&&(a=q.exec(w));){u=a.index,z=u+a[0].length,g.lineNumber++}g.columnNumber=i-u+1}for(var u=0,z=0,q=/.*(?:\r\n?|\n)|.*$/g,g=s.locator,o=[{currentNSMap:r}],m={},l=0;;){try{var A=w.indexOf("<",l);if(A<0){if(!w.substr(l).match(/^\s*$/)){var H=s.doc,t=H.createTextNode(w.substr(l));H.appendChild(t),s.currentElement=t}return}switch(A>l&&D(A),w.charAt(A+1)){case"/":var f=w.indexOf(">",A+3),c=w.substring(A+2,f),F=o.pop();f<0?(c=w.substring(A+2).replace(/[\s<].*/,""),n.error("end tag name: "+c+" is not complete:"+F.tagName),f=A+1+c.length):c.match(/\s</)&&(c=c.replace(/[\s<].*/,""),n.error("end tag name: "+c+" maybe not complete"),f=A+1+c.length);var j=F.localNSMap,d=F.tagName==c;if(d||F.tagName&&F.tagName.toLowerCase()==c.toLowerCase()){if(s.endElement(F.uri,F.localName,c),j){for(var x in j){s.endPrefixMapping(x)}}d||n.fatalError("end tag name: "+c+" is not match the current start tagName:"+F.tagName)}else{o.push(F)}f++;break;case"?":g&&G(A),f=parseInstruction(w,A,s);break;case"!":g&&G(A),f=parseDCC(w,A,s,n);break;default:g&&G(A);var b=new ElementAttributes,h=o[o.length-1].currentNSMap,B=(f=parseElementStartPart(w,A,b,h,p,n),b.length);if(!b.closed&&fixSelfClosed(w,f,b.tagName,m)&&(b.closed=!0,k.nbsp||n.warning("unclosed xml attribute")),g&&B){for(var v=copyLocator(g,{}),y=0;y<B;y++){var E=b[y];G(E.offset),E.locator=copyLocator(g,{})}s.locator=v,appendElementFromSax(b,s,h)&&o.push(b),s.locator=g}else{appendElementFromSax(b,s,h)&&o.push(b)}"http://www.w3.org/1999/xhtml"!==b.uri||b.closed?f++:f=parseHtmlSpecialContent(w,f,b.tagName,p,s)}}catch(C){n.error("element parse error: "+C),f=-1}f>l?l=f:D(Math.max(A,l)+1)}}function copyLocator(b,a){return a.lineNumber=b.lineNumber,a.columnNumber=b.columnNumber,a}function parseElementStartPart(a,b,f,l,k,g){for(var i,d=++b,m=S_TAG;;){var h=a.charAt(d);switch(h){case"=":if(m===S_ATTR){i=a.slice(b,d),m=S_EQ}else{if(m!==S_ATTR_SPACE){throw new Error("attribute equal must after attrName")}m=S_EQ}break;case"'":case'"':if(m===S_EQ||m===S_ATTR){if(m===S_ATTR&&(g.warning('attribute value must after "="'),i=a.slice(b,d)),b=d+1,!((d=a.indexOf(h,b))>0)){throw new Error("attribute value no end '"+h+"' match")}j=a.slice(b,d).replace(/&#?\w+;/g,k),f.add(i,j,b-1),m=S_ATTR_END}else{if(m!=S_ATTR_NOQUOT_VALUE){throw new Error('attribute value must after "="')}j=a.slice(b,d).replace(/&#?\w+;/g,k),f.add(i,j,b),g.warning('attribute "'+i+'" missed start quot('+h+")!!"),b=d+1,m=S_ATTR_END}break;case"/":switch(m){case S_TAG:f.setTagName(a.slice(b,d));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:m=S_TAG_CLOSE,f.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return g.error("unexpected end of input"),m==S_TAG&&f.setTagName(a.slice(b,d)),d;case">":switch(m){case S_TAG:f.setTagName(a.slice(b,d));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:"/"===(j=a.slice(b,d)).slice(-1)&&(f.closed=!0,j=j.slice(0,-1));case S_ATTR_SPACE:m===S_ATTR_SPACE&&(j=i),m==S_ATTR_NOQUOT_VALUE?(g.warning('attribute "'+j+'" missed quot(")!!'),f.add(i,j.replace(/&#?\w+;/g,k),b)):("http://www.w3.org/1999/xhtml"===l[""]&&j.match(/^(?:disabled|checked|selected)$/i)||g.warning('attribute "'+j+'" missed value!! "'+j+'" instead!!'),f.add(j,j,b));break;case S_EQ:throw new Error("attribute value missed!!")}return d;case"":h=" ";default:if(h<=" "){switch(m){case S_TAG:f.setTagName(a.slice(b,d)),m=S_TAG_SPACE;break;case S_ATTR:i=a.slice(b,d),m=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var j=a.slice(b,d).replace(/&#?\w+;/g,k);g.warning('attribute "'+j+'" missed quot(")!!'),f.add(i,j,b);case S_ATTR_END:m=S_TAG_SPACE}}else{switch(m){case S_ATTR_SPACE:f.tagName;"http://www.w3.org/1999/xhtml"===l[""]&&i.match(/^(?:disabled|checked|selected)$/i)||g.warning('attribute "'+i+'" missed value!! "'+i+'" instead2!!'),f.add(i,i,b),b=d,m=S_ATTR;break;case S_ATTR_END:g.warning('attribute space is required"'+i+'"!!');case S_TAG_SPACE:m=S_ATTR,b=d;break;case S_EQ:m=S_ATTR_NOQUOT_VALUE,b=d;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}}d++}}function appendElementFromSax(d,l,q){for(var g=d.tagName,c=null,j=d.length;j--;){var o=d[j],m=o.qName,p=o.value;if((b=m.indexOf(":"))>0){var k=o.prefix=m.slice(0,b),h=m.slice(b+1),f="xmlns"===k&&h}else{h=m,k=null,f="xmlns"===m&&""}o.localName=h,!1!==f&&(null==c&&(c={},_copy(q,q={})),q[f]=c[f]=p,o.uri="http://www.w3.org/2000/xmlns/",l.startPrefixMapping(f,p))}for(j=d.length;j--;){(k=(o=d[j]).prefix)&&("xml"===k&&(o.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==k&&(o.uri=q[k||""]))}var b;(b=g.indexOf(":"))>0?(k=d.prefix=g.slice(0,b),h=d.localName=g.slice(b+1)):(k=null,h=d.localName=g);var n=d.uri=q[k||""];if(l.startElement(n,h,g,d),!d.closed){return d.currentNSMap=q,d.localNSMap=c,!0}if(l.endElement(n,h,g),c){for(k in c){l.endPrefixMapping(k)}}}function parseHtmlSpecialContent(f,c,b,g,d){if(/^(?:script|textarea)$/i.test(b)){var a=f.indexOf("</"+b+">",c),h=f.substring(c+1,a);if(/[&<]/.test(h)){return/^script$/i.test(b)?(d.characters(h,0,h.length),a):(h=h.replace(/&#?\w+;/g,g),d.characters(h,0,h.length),a)}}return c+1}function fixSelfClosed(d,c,b,a){var f=a[b];return null==f&&((f=d.lastIndexOf("</"+b+">"))<c&&(f=d.lastIndexOf("</"+b)),a[b]=f),f<c}function _copy(a,b){for(var c in a){b[c]=a[c]}}function parseDCC(a,d,i,j){switch(a.charAt(d+2)){case"-":return"-"===a.charAt(d+3)?(g=a.indexOf("--\x3e",d+4))>d?(i.comment(a,d+4,g-d-4),g+3):(j.error("Unclosed comment"),-1):-1;default:if("CDATA["==a.substr(d+3,6)){var g=a.indexOf("]]>",d+9);return i.startCDATA(),i.characters(a,d+9,g-d-9),i.endCDATA(),g+3}var b=split(a,d),l=b.length;if(l>1&&/!doctype/i.test(b[0][0])){var c=b[1][0],f=l>3&&/^public$/i.test(b[2][0])&&b[3][0],k=l>4&&b[4][0],h=b[l-1];return i.startDTD(c,f&&f.replace(/^(['"])(.*?)\1$/,"$2"),k&&k.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),h.index+h[0].length}}return -1}function parseInstruction(d,f,c){var a=d.indexOf("?>",f);if(a){var b=d.substring(f,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(b){b[0].length;return c.processingInstruction(b[1],b[2]),a+2}return -1}return -1}function ElementAttributes(a){}function split(d,f){var b,a=[],c=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(c.lastIndex=f,c.exec(d);b=c.exec(d);){if(a.push(b),b[1]){return a}}}function copy(c,a){for(var b in c){a[b]=c[b]}}function _extends(a,c){var d=a.prototype;if(!(d instanceof c)){function b(){}b.prototype=c.prototype,copy(d,b=new b),a.prototype=d=b}d.constructor!=a&&("function"!=typeof a&&console.error("unknow Class:"+a),d.constructor=a)}XMLReader.prototype={parse:function(d,b,a){var c=this.domBuilder;c.startDocument(),_copy(b,b={}),parse(d,b,a,c,this.errorHandler),c.endDocument()}},ElementAttributes.prototype={setTagName:function(a){if(!tagNamePattern.test(a)){throw new Error("invalid tagName:"+a)}this.tagName=a},add:function(b,a,c){if(!tagNamePattern.test(b)){throw new Error("invalid attribute:"+b)}this[this.length++]={qName:b,value:a,offset:c}},length:0,getLocalName:function(a){return this[a].localName},getLocator:function(a){return this[a].locator},getQName:function(a){return this[a].qName},getURI:function(a){return this[a].uri},getValue:function(a){return this[a].value}},exports.XMLReader=XMLReader;var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={},INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2),HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3),WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7),NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8),NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9),INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10),INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(c,b){if(b instanceof Error){var a=b}else{a=this,Error.call(this,ExceptionMessage[c]),this.message=ExceptionMessage[c],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException)}return a.code=c,b&&(this.message=this.message+": "+b),a}function NodeList(){}function LiveNodeList(b,a){this._node=b,this._refresh=a,_updateLiveList(this)}function _updateLiveList(b){var c=b._node._inc||b._node.ownerDocument._inc;if(b._inc!=c){var a=b._refresh(b._node);__set__(b,"length",a.length),copy(a,b),b._inc=c}}function NamedNodeMap(){}function _findNodeIndex(c,b){for(var a=c.length;a--;){if(c[a]===b){return a}}}function _addNamedNode(b,c,f,a){if(a?c[_findNodeIndex(c,a)]=f:c[c.length++]=f,b){f.ownerElement=b;var d=b.ownerDocument;d&&(a&&_onRemoveAttribute(d,b,a),_onAddAttribute(d,b,f))}}function _removeNamedNode(c,d,a){var b=_findNodeIndex(d,a);if(!(b>=0)){throw DOMException(NOT_FOUND_ERR,new Error(c.tagName+"@"+a))}for(var g=d.length-1;b<g;){d[b]=d[++b]}if(d.length=g,c){var f=c.ownerDocument;f&&(_onRemoveAttribute(f,c,a),a.ownerElement=null)}}function DOMImplementation(b){if(this._features={},b){for(var a in b){this._features=b[a]}}}function Node(){}function _xmlEncoder(a){return("<"==a?"&lt;":">"==a&&"&gt;")||"&"==a&&"&amp;"||'"'==a&&"&quot;"||"&#"+a.charCodeAt()+";"}function _visitNode(a,b){if(b(a)){return !0}if(a=a.firstChild){do{if(_visitNode(a,b)){return !0}}while(a=a.nextSibling)}}function Document(){}function _onAddAttribute(b,a,c){b&&b._inc++,"http://www.w3.org/2000/xmlns/"==c.namespaceURI&&(a._nsMap[c.prefix?c.localName:""]=c.value)}function _onRemoveAttribute(c,b,d,a){c&&c._inc++,"http://www.w3.org/2000/xmlns/"==d.namespaceURI&&delete b._nsMap[d.prefix?d.localName:""]}function _onUpdateChild(f,d,a){if(f&&f._inc){f._inc++;var c=d.childNodes;if(a){c[c.length++]=a}else{for(var g=d.firstChild,b=0;g;){c[b++]=g,g=g.nextSibling}c.length=b}}}function _removeChild(a,d){var c=d.previousSibling,b=d.nextSibling;return c?c.nextSibling=b:a.firstChild=b,b?b.previousSibling=c:a.lastChild=c,_onUpdateChild(a.ownerDocument,a),d}function _insertBefore(b,a,d){var g=a.parentNode;if(g&&g.removeChild(a),a.nodeType===DOCUMENT_FRAGMENT_NODE){var h=a.firstChild;if(null==h){return a}var c=a.lastChild}else{h=c=a}var f=d?d.previousSibling:b.lastChild;for(h.previousSibling=f,c.nextSibling=d,f?f.nextSibling=h:b.firstChild=h,null==d?b.lastChild=c:d.previousSibling=c;h.parentNode=b,h!==c&&(h=h.nextSibling);){}return _onUpdateChild(b.ownerDocument||b,b),a.nodeType==DOCUMENT_FRAGMENT_NODE&&(a.firstChild=a.lastChild=null),a}function _appendSingleChild(b,a){var d=a.parentNode;if(d){var c=b.lastChild;d.removeChild(a);c=b.lastChild}c=b.lastChild;return a.parentNode=b,a.previousSibling=c,a.nextSibling=null,c?c.nextSibling=a:b.firstChild=a,b.lastChild=a,_onUpdateChild(b.ownerDocument,b,a),a}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function nodeSerializeToString(f,a){var c=[],b=9==this.nodeType&&this.documentElement||this,h=b.prefix,g=b.namespaceURI;if(g&&null==h&&null==(h=b.lookupPrefix(g))){var d=[{namespace:g,prefix:null}]}return serializeToString(this,c,f,a,d),c.join("")}function needNamespaceDefine(g,a,c){var h=g.prefix||"",f=g.namespaceURI;if(!h&&!f){return !1}if("xml"===h&&"http://www.w3.org/XML/1998/namespace"===f||"http://www.w3.org/2000/xmlns/"==f){return !1}for(var b=c.length;b--;){var d=c[b];if(d.prefix==h){return d.namespace!=f}}return !0}function serializeToString(g,d,o,h,r){if(h){if(!(g=h(g))){return}if("string"==typeof g){return void d.push(g)}}switch(g.nodeType){case ELEMENT_NODE:r||(r=[]);r.length;var s=g.attributes,m=s.length,c=g.firstChild,q=g.tagName;o=htmlns===g.namespaceURI||o,d.push("<",q);for(var j=0;j<m;j++){"xmlns"==(n=s.item(j)).prefix?r.push({prefix:n.localName,namespace:n.value}):"xmlns"==n.nodeName&&r.push({prefix:"",namespace:n.value})}for(j=0;j<m;j++){var n;if(needNamespaceDefine(n=s.item(j),o,r)){var k=n.prefix||"",f=n.namespaceURI,p=k?" xmlns:"+k:" xmlns";d.push(p,'="',f,'"'),r.push({prefix:k,namespace:f})}serializeToString(n,d,o,h,r)}if(needNamespaceDefine(g,o,r)){k=g.prefix||"",f=g.namespaceURI,p=k?" xmlns:"+k:" xmlns";d.push(p,'="',f,'"'),r.push({prefix:k,namespace:f})}if(c||o&&!/^(?:meta|link|img|br|hr|input)$/i.test(q)){if(d.push(">"),o&&/^script$/i.test(q)){for(;c;){c.data?d.push(c.data):serializeToString(c,d,o,h,r),c=c.nextSibling}}else{for(;c;){serializeToString(c,d,o,h,r),c=c.nextSibling}}d.push("</",q,">")}else{d.push("/>")}return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(c=g.firstChild;c;){serializeToString(c,d,o,h,r),c=c.nextSibling}return;case ATTRIBUTE_NODE:return d.push(" ",g.name,'="',g.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return d.push(g.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return d.push("<![CDATA[",g.data,"]]>");case COMMENT_NODE:return d.push("\x3c!--",g.data,"--\x3e");case DOCUMENT_TYPE_NODE:var b=g.publicId,l=g.systemId;if(d.push("<!DOCTYPE ",g.name),b){d.push(' PUBLIC "',b),l&&"."!=l&&d.push('" "',l),d.push('">')}else{if(l&&"."!=l){d.push(' SYSTEM "',l,'">')}else{var a=g.internalSubset;a&&d.push(" [",a,"]"),d.push(">")}}return;case PROCESSING_INSTRUCTION_NODE:return d.push("<?",g.target," ",g.data,"?>");case ENTITY_REFERENCE_NODE:return d.push("&",g.nodeName,";");default:d.push("??",g.nodeName)}}function importNode(d,c,b){var a;switch(c.nodeType){case ELEMENT_NODE:(a=c.cloneNode(!1)).ownerDocument=d;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:b=!0}if(a||(a=c.cloneNode(!1)),a.ownerDocument=d,a.parentNode=null,b){for(var f=c.firstChild;f;){a.appendChild(importNode(d,f,b)),f=f.nextSibling}}return a}function cloneNode(h,d,l){var m=new d.constructor;for(var c in d){var k=d[c];"object"!=typeof k&&k!=m[c]&&(m[c]=k)}switch(d.childNodes&&(m.childNodes=new NodeList),m.ownerDocument=h,m.nodeType){case ELEMENT_NODE:var j=d.attributes,a=m.attributes=new NamedNodeMap,g=j.length;a._ownerElement=m;for(var f=0;f<g;f++){m.setAttributeNode(cloneNode(h,j.item(f),!0))}break;case ATTRIBUTE_NODE:l=!0}if(l){for(var b=d.firstChild;b;){m.appendChild(cloneNode(h,b,l)),b=b.nextSibling}}return m}function __set__(a,b,c){a[b]=c}DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException),NodeList.prototype={length:0,item:function(a){return this[a]||null},toString:function(b,a){for(var c=[],d=0;d<this.length;d++){serializeToString(this[d],c,b,a)}return c.join("")}},LiveNodeList.prototype.item=function(a){return _updateLiveList(this),this[a]},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(c){for(var b=this.length;b--;){var a=this[b];if(a.nodeName==c){return a}}},setNamedItem:function(a){var c=a.ownerElement;if(c&&c!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}var b=this.getNamedItem(a.nodeName);return _addNamedNode(this._ownerElement,this,a,b),b},setNamedItemNS:function(a){var b,c=a.ownerElement;if(c&&c!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}return b=this.getNamedItemNS(a.namespaceURI,a.localName),_addNamedNode(this._ownerElement,this,a,b),b},removeNamedItem:function(b){var a=this.getNamedItem(b);return _removeNamedNode(this._ownerElement,this,a),a},removeNamedItemNS:function(c,b){var a=this.getNamedItemNS(c,b);return _removeNamedNode(this._ownerElement,this,a),a},getNamedItemNS:function(b,a){for(var c=this.length;c--;){var d=this[c];if(d.localName==a&&d.namespaceURI==b){return d}}return null}},DOMImplementation.prototype={hasFeature:function(c,b){var a=this._features[c.toLowerCase()];return !(!a||b&&!(b in a))},createDocument:function(c,f,b){var d=new Document;if(d.implementation=this,d.childNodes=new NodeList,d.doctype=b,b&&d.appendChild(b),f){var a=d.createElementNS(c,f);d.appendChild(a)}return d},createDocumentType:function(c,d,a){var b=new DocumentType;return b.name=c,b.nodeName=c,b.publicId=d,b.systemId=a,b}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(a,b){return _insertBefore(this,a,b)},replaceChild:function(a,b){this.insertBefore(a,b),b&&this.removeChild(b)},removeChild:function(a){return _removeChild(this,a)},appendChild:function(a){return this.insertBefore(a,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(a){return cloneNode(this.ownerDocument||this,this,a)},normalize:function(){for(var b=this.firstChild;b;){var a=b.nextSibling;a&&a.nodeType==TEXT_NODE&&b.nodeType==TEXT_NODE?(this.removeChild(a),b.appendData(a.data)):(b.normalize(),b=a)}},isSupported:function(b,a){return this.ownerDocument.implementation.hasFeature(b,a)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(a){for(var b=this;b;){var c=b._nsMap;if(c){for(var d in c){if(c[d]==a){return d}}}b=b.nodeType==ATTRIBUTE_NODE?b.ownerDocument:b.parentNode}return null},lookupNamespaceURI:function(b){for(var a=this;a;){var c=a._nsMap;if(c&&b in c){return c[b]}a=a.nodeType==ATTRIBUTE_NODE?a.ownerDocument:a.parentNode}return null},isDefaultNamespace:function(a){return null==this.lookupPrefix(a)}},copy(NodeType,Node),copy(NodeType,Node.prototype),Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(a,b){if(a.nodeType==DOCUMENT_FRAGMENT_NODE){for(var d=a.firstChild;d;){var c=d.nextSibling;this.insertBefore(d,b),d=c}return a}return null==this.documentElement&&a.nodeType==ELEMENT_NODE&&(this.documentElement=a),_insertBefore(this,a,b),a.ownerDocument=this,a},removeChild:function(a){return this.documentElement==a&&(this.documentElement=null),_removeChild(this,a)},importNode:function(b,a){return importNode(this,b,a)},getElementById:function(b){var a=null;return _visitNode(this.documentElement,function(c){if(c.nodeType==ELEMENT_NODE&&c.getAttribute("id")==b){return a=c,!0}}),a},createElement:function(a){var b=new Element;return b.ownerDocument=this,b.nodeName=a,b.tagName=a,b.childNodes=new NodeList,(b.attributes=new NamedNodeMap)._ownerElement=b,b},createDocumentFragment:function(){var a=new DocumentFragment;return a.ownerDocument=this,a.childNodes=new NodeList,a},createTextNode:function(b){var a=new Text;return a.ownerDocument=this,a.appendData(b),a},createComment:function(b){var a=new Comment;return a.ownerDocument=this,a.appendData(b),a},createCDATASection:function(b){var a=new CDATASection;return a.ownerDocument=this,a.appendData(b),a},createProcessingInstruction:function(c,b){var a=new ProcessingInstruction;return a.ownerDocument=this,a.tagName=a.target=c,a.nodeValue=a.data=b,a},createAttribute:function(a){var b=new Attr;return b.ownerDocument=this,b.name=a,b.nodeName=a,b.localName=a,b.specified=!0,b},createEntityReference:function(a){var b=new EntityReference;return b.ownerDocument=this,b.nodeName=a,b},createElementNS:function(b,f){var d=new Element,c=f.split(":"),a=d.attributes=new NamedNodeMap;return d.childNodes=new NodeList,d.ownerDocument=this,d.nodeName=f,d.tagName=f,d.namespaceURI=b,2==c.length?(d.prefix=c[0],d.localName=c[1]):d.localName=f,a._ownerElement=d,d},createAttributeNS:function(a,d){var c=new Attr,b=d.split(":");return c.ownerDocument=this,c.nodeName=d,c.name=d,c.namespaceURI=a,c.specified=!0,2==b.length?(c.prefix=b[0],c.localName=b[1]):c.localName=d,c}},_extends(Document,Node),Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(a){return null!=this.getAttributeNode(a)},getAttribute:function(b){var a=this.getAttributeNode(b);return a&&a.value||""},getAttributeNode:function(a){return this.attributes.getNamedItem(a)},setAttribute:function(b,c){var a=this.ownerDocument.createAttribute(b);a.value=a.nodeValue=""+c,this.setAttributeNode(a)},removeAttribute:function(b){var a=this.getAttributeNode(b);a&&this.removeAttributeNode(a)},appendChild:function(a){return a.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(a,null):_appendSingleChild(this,a)},setAttributeNode:function(a){return this.attributes.setNamedItem(a)},setAttributeNodeNS:function(a){return this.attributes.setNamedItemNS(a)},removeAttributeNode:function(a){return this.attributes.removeNamedItem(a.nodeName)},removeAttributeNS:function(c,b){var a=this.getAttributeNodeNS(c,b);a&&this.removeAttributeNode(a)},hasAttributeNS:function(b,a){return null!=this.getAttributeNodeNS(b,a)},getAttributeNS:function(c,b){var a=this.getAttributeNodeNS(c,b);return a&&a.value||""},setAttributeNS:function(b,d,c){var a=this.ownerDocument.createAttributeNS(b,d);a.value=a.nodeValue=""+c,this.setAttributeNode(a)},getAttributeNodeNS:function(b,a){return this.attributes.getNamedItemNS(b,a)},getElementsByTagName:function(a){return new LiveNodeList(this,function(c){var b=[];return _visitNode(c,function(d){d===c||d.nodeType!=ELEMENT_NODE||"*"!==a&&d.tagName!=a||b.push(d)}),b})},getElementsByTagNameNS:function(b,a){return new LiveNodeList(this,function(d){var c=[];return _visitNode(d,function(f){f===d||f.nodeType!==ELEMENT_NODE||"*"!==b&&f.namespaceURI!==b||"*"!==a&&f.localName!=a||c.push(f)}),c})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node),CharacterData.prototype={data:"",substringData:function(b,a){return this.data.substring(b,b+a)},appendData:function(a){a=this.data+a,this.nodeValue=this.data=a,this.length=a.length},insertData:function(b,a){this.replaceData(b,0,a)},appendChild:function(a){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(b,a){this.replaceData(b,a,"")},replaceData:function(c,a,b){b=this.data.substring(0,c)+b+this.data.substring(c+a),this.nodeValue=this.data=b,this.length=b.length}},_extends(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(d){var c=this.data,b=c.substring(d);c=c.substring(0,d),this.data=this.nodeValue=c,this.length=c.length;var a=this.ownerDocument.createTextNode(b);return this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling),a}},_extends(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node),Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node),Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node),EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(c,b,a){return nodeSerializeToString.call(c,b,a)},Node.prototype.toString=nodeSerializeToString;try{if(Object.defineProperty){function getTextContent(b){switch(b.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var a=[];for(b=b.firstChild;b;){7!==b.nodeType&&8!==b.nodeType&&a.push(getTextContent(b)),b=b.nextSibling}return a.join("");default:return b.nodeValue}}Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(a){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;){this.removeChild(this.firstChild)}(a||String(a))&&this.appendChild(this.ownerDocument.createTextNode(a));break;default:this.data=a,this.value=a,this.nodeValue=a}}}),__set__=function(a,b,c){a["$$"+b]=c}}}catch(e){}function DOMParser(a){this.options=a||{locator:{}}}function buildErrorHandler(c,d,a){if(!c){if(d instanceof DOMHandler){return d}c=d}var b={},f=c instanceof Function;function g(h){var i=c[h];!i&&f&&(i=2==c.length?function(j){c(h,j)}:c),b[h]=i&&function(j){i("[xmldom "+h+"]\t"+j+_locator(a))}||function(){}}return a=a||{},g("warning"),g("error"),g("fatalError"),b}function DOMHandler(){this.cdata=!1}function position(a,b){b.lineNumber=a.lineNumber,b.columnNumber=a.columnNumber}function _locator(a){if(a){return"\n@"+(a.systemId||"")+"#[line:"+a.lineNumber+",col:"+a.columnNumber+"]"}}function _toString(b,c,a){return"string"==typeof b?b.substr(c,a):b.length>=c+a||c?new java.lang.String(b,c,a)+"":b}function appendElement(a,b){a.currentElement?a.currentElement.appendChild(b):a.doc.appendChild(b)}exports.DOMImplementation=DOMImplementation,exports.XMLSerializer=XMLSerializer,DOMParser.prototype.parseFromString=function(b,c){var k=this.options,a=new XMLReader,g=k.domBuilder||new DOMHandler,h=k.errorHandler,d=k.locator,j=k.xmlns||{},i=/\/x?html?$/.test(c),f=i?htmlEntity.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return d&&g.setDocumentLocator(d),a.errorHandler=buildErrorHandler(h,g,d),a.domBuilder=k.domBuilder||g,i&&(j[""]="http://www.w3.org/1999/xhtml"),j.xml=j.xml||"http://www.w3.org/XML/1998/namespace",b?a.parse(b,j,f):a.errorHandler.error("invalid doc source"),g.doc},DOMHandler.prototype={startDocument:function(){this.doc=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(b,c,h,l){var k=this.doc,a=k.createElementNS(b,h||c),f=l.length;appendElement(this,a),this.currentElement=a,this.locator&&position(this.locator,a);for(var d=0;d<f;d++){b=l.getURI(d);var j=l.getValue(d),g=(h=l.getQName(d),k.createAttributeNS(b,h));this.locator&&position(l.getLocator(d),g),g.value=g.nodeValue=j,a.setAttributeNode(g)}},endElement:function(b,a,c){var d=this.currentElement;d.tagName;this.currentElement=d.parentNode},startPrefixMapping:function(b,a){},endPrefixMapping:function(a){},processingInstruction:function(c,b){var a=this.doc.createProcessingInstruction(c,b);this.locator&&position(this.locator,a),appendElement(this,a)},ignorableWhitespace:function(a,c,b){},characters:function(c,d,b){if(c=_toString.apply(this,arguments)){if(this.cdata){var a=this.doc.createCDATASection(c)}else{a=this.doc.createTextNode(c)}this.currentElement?this.currentElement.appendChild(a):/^\s*$/.test(c)&&this.doc.appendChild(a),this.locator&&position(this.locator,a)}},skippedEntity:function(a){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(a){(this.locator=a)&&(a.lineNumber=0)},comment:function(c,d,b){c=_toString.apply(this,arguments);var a=this.doc.createComment(c);this.locator&&position(this.locator,a),appendElement(this,a)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(c,f,a){var b=this.doc.implementation;if(b&&b.createDocumentType){var d=b.createDocumentType(c,f,a);this.locator&&position(this.locator,d),appendElement(this,d)}},warning:function(a){console.warn("[xmldom warning]\t"+a,_locator(this.locator))},error:function(a){console.error("[xmldom error]\t"+a,_locator(this.locator))},fatalError:function(a){throw console.error("[xmldom fatalError]\t"+a,_locator(this.locator)),a}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(a){DOMHandler.prototype[a]=function(){return null}});module.exports={GS:GS,tool:tool,task:task,DOMParser:DOMParser};